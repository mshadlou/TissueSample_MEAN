angular.module("Tissue_Sample_Project",["ngRoute"]),angular.module("Tissue_Sample_Project").controller("ApplicationCtrl",["$scope","$location","$rootScope",function(e,t,a){e.isLogOut=!0,e.ServerURL=HostName,e.isNotHome=!1,document.getElementById("PageName").innerHTML="","/"!==t.url()&&(e.isNotHome=!0),e.closeNav=function(){document.getElementById("mySidenav").style.width="0",document.getElementById("myDarkBack").style.width="0"},e.Snackbar=function(e){var t=document.getElementById("snackbar");t.innerHTML=e,t.className="show",setTimeout(function(){t.className=t.className.replace("show","")},3e3)},e.Warning_Snackbar=function(e){var t=document.getElementById("warning_snackbar");t.innerHTML=e,t.className="showWS",setTimeout(function(){t.className=t.className.replace("showWS","")},4e3)},a.$on("$routeChangeStart",function(a,o,l){e.isNotHome=!1,"/"===t.url()||"/403"===t.url()?t.replace():e.isNotHome=!0})}]),angular.module("Tissue_Sample_Project").controller("DashboardCtrl",["$scope","DashboardSvc","utils",function(e,t,a){e.Show_CollectionForm=!0,e.Show_SampleForm=!1,e.Show_CollectionTables=!0,e.Show_SampleTables=!1,e.count_EditCollection=0,e.temp_id_collection=0,e.s_datain={},e.c_datain={},e.Collection_search_results=[],e.Sample_results=[];e.Table_S=0;let o=!1;e.Max_no_ids_per_page=5,e.PageID=1,e.Show_Pagination=!1,e.Show_PagePrevious=!1,e.Show_PageNext=!1,e.ResetView=function(){e.Show_CollectionForm=!0,e.Show_SampleForm=!1,e.Show_SampleTables=!1},e.SetMaxRows=function(t){e.Max_no_ids_per_page=parseInt(t),e.PageID=1,e.pageloader(e.PageID),e.ResetView()},e.pageloader=function(a){let o=t.fetchCollections(a,e.Max_no_ids_per_page);o.out?(e.Collection_search_results=[],o.data.forEach((t,a)=>{e.Collection_search_results.push({id:t.id,disease_term:t.disease_term,title:t.title,date:t.date,htmlcode:"✕"})}),o.count>e.Max_no_ids_per_page&&(e.Show_Pagination=!0),e.Show_PagePrevious=o.prev,e.Show_PageNext=o.next):e.Warning_Snackbar(o.message)},e.nextPage=function(){++this.PageID,e.pageloader(e.PageID),e.ResetView()},e.previousPage=function(){--this.PageID,e.pageloader(e.PageID),e.ResetView()},e.pageloader(e.PageID),e.CollectionSearch=function(){if(e.search_query.length>=4){o=!0;let a=t.searchCollections(e.search_query);a.out?(e.Collection_search_results=[],a.data.forEach((t,a)=>{e.Collection_search_results.push({id:t.id,disease_term:t.disease_term,title:t.title,date:t.date,htmlcode:"✕"})})):e.Warning_Snackbar(a.message)}else o&&(o=!1,e.pageloader(e.PageID))},e.Update_CollectionForm=function(o){t.CRUDcollection(o,"create/update").then(t=>{t.out?(t.create?(e.Collection_search_results.push({id:t.data.id,disease_term:t.data.disease_term,title:t.data.title,date:t.data.date,htmlcode:"✕"}),e.Collection_search_results.length>e.Max_no_ids_per_page&&(++e.PageID,e.pageloader(e.PageID))):e.Collection_search_results.forEach((e,a)=>{e.id==t.data.id&&(e.disease_term=t.data.disease_term,e.title=t.data.title)}),a.set_form_empty(o)):e.Warning_Snackbar(t.message)})},e.Update_SampleForm=function(){t.CRUDsample(e.s_datain,"create/update").then(t=>{t.out?(t.create?(e.Sample_results.push(t.data),++e.Table_S,e.Show_SampleTables=!0):e.Sample_results.forEach((e,a)=>{e.id==t.data.id&&(e.donor_count=t.data.donor_count,e.mat_type=t.data.mat_type)}),e.s_datain.id=0,e.s_datain.donor_count=0,e.s_datain.mat_type=""):e.Warning_Snackbar(t.message)})},e.DisplaySample=function(a){e.ResetView(),e.Collection_search_results.forEach((o,l)=>{if(o.id==a&&"✕"==o.htmlcode){o.htmlcode="✓";let a=t.searchSamples(o.id);a.out?(e.Sample_results=[],e.Sample_results=a.data,e.Table_S=a.data.length,e.Show_SampleTables=!0,++e.count_EditCollection):(e.Warning_Snackbar(a.message),e.Sample_results=[],e.Table_S=0),e.Show_SampleForm=!0,e.Show_CollectionForm=!1,e.s_datain={id:0,c_id:o.id,donor_count:0,mat_type:""}}else o.htmlcode="✕"})},e.EditCollection=function(t){e.Show_SampleTables=!1,e.Show_SampleForm=!1,e.count_EditCollection>=1&&(e.Show_CollectionForm?e.Show_CollectionForm=!1:e.Show_CollectionForm=!0),e.temp_id_collection!=t&&(e.temp_id_collection=t,e.Show_CollectionForm=!0),++e.count_EditCollection,e.Collection_search_results.forEach((a,o)=>{a.id==t&&(e.c_datain={id:a.id,disease_term:a.disease_term,title:a.title,htmlcode:"✕"},e.Collection_search_results[o].htmlcode="✕")})},e.EditSample=function(t){e.Sample_results.forEach((a,o)=>{a.id==t&&(e.s_datain={id:a.id,c_id:a.c_id,donor_count:a.donor_count,mat_type:a.mat_type})})},e.DeleteCollection=function(o){e.ModalMessage="This will delete both Collection and all associated Samples permanently!",a.WarningModal(a=>{a&&e.Collection_search_results.forEach((a,l)=>{if(a.id==o){let o={id:a.id,disease_term:a.disease_term,title:a.title};t.CRUDcollection(o,"delete").then(t=>{t.out?(e.Collection_search_results.splice(l,1),0==e.Collection_search_results.length&&e.PageID>1&&(--e.PageID,e.pageloader(e.PageID))):e.Warning_Snackbar(t.message)})}})})},e.DeleteSample=function(o){e.ModalMessage="This will delete this Sample permanently!",a.WarningModal(a=>{if(a){let a=e.Sample_results.findIndex(e=>e.id===o);a>=0&&t.CRUDsample({id:o,c_id:e.Sample_results[a].c_id,donor_count:e.Sample_results[a].donor_count,mat_type:e.Sample_results[a].mat_type},"delete").then(t=>{t.out?(e.Sample_results.splice(a,1),--e.Table_S):e.Warning_Snackbar(t.message)})}})}}]),angular.module("Tissue_Sample_Project").service("DashboardSvc",["$http",function(e){var t=HostName;this.fetchCollections=function(e,a){var o=new XMLHttpRequest;return o.open("GET",t+"/pro/getCollection/"+e+"/"+a,!1),o.send(),JSON.parse(o.responseText)},this.searchCollections=function(e){var a=new XMLHttpRequest;return a.open("GET",t+"/pro/searchCollection/"+e,!1),a.send(),JSON.parse(a.responseText)},this.CRUDcollection=function(a,o){return e.post(t+"/pro/CRUDcollection",{data:a,com:o}).then(e=>e.data)},this.searchSamples=function(e){var a=new XMLHttpRequest;return a.open("GET",t+"/pro/searchSample/"+e,!1),a.send(),JSON.parse(a.responseText)},this.CRUDsample=function(a,o){return e.post(t+"/pro/CRUDsample",{data:a,com:o}).then(e=>e.data)}}]),angular.module("Tissue_Sample_Project").filter("ShowDateDDMMYYY",[function(){return function(e){if(!angular.isString(e))return e;let t=Date.parse(e);return moment(new Date(t)).format("DD/MM/YYYY")}}]).filter("range",function(){return function(e,t){t=parseInt(t);for(var a=0;a<t;a++)e.push(a);return e}}),angular.module("Tissue_Sample_Project").service("authInterceptor",["$q","$location",function(e,t){HostName;this.responseError=function(a){return 401===a.status&&t.path("/").replace(),403===a.status&&t.path("/403").replace(),404===a.status&&t.path("/404").replace(),500===a.status&&t.path("/500").replace(),e.reject(a)}}]),angular.module("Tissue_Sample_Project").config(["$routeProvider","$locationProvider",function(e,t){t.html5Mode(!0),e.when("/",{controller:"DashboardCtrl",templateUrl:"dashboard.html"}).when("/404",{templateUrl:"404.html"}).when("/403",{templateUrl:"403.html"}).when("/500",{templateUrl:"404.html"})}]).config(["$httpProvider",function(e){e.interceptors.push("authInterceptor")}]),angular.module("Tissue_Sample_Project").service("utils",function(){this.set_form_empty=function(e){Object.keys(e).forEach((t,a)=>{e[""+t]=""})},this.DateReturn=function(e){let t=e.split("/")[0],a=e.split("/")[1]-1,o=e.split("/")[2];return new Date(o,a,t)},this.WarningModal=function(e){var t=document.getElementById("WarningModelStatic"),a=document.getElementById("CloseModal1"),o=document.getElementById("CloseModal2"),l=document.getElementById("ApproveModal");t.style.display="block",t.className="modal fade show",a.addEventListener("click",a=>{t.style.display="none",t.className="modal fade",e(!1)}),o.addEventListener("click",a=>{t.style.display="none",t.className="modal fade",e(!1)}),l.addEventListener("click",a=>{t.style.display="none",t.className="modal fade",e(!0)})}});